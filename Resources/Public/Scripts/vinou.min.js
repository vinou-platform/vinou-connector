var vinouEnquiry={wines:document.querySelectorAll('input[name*="[quantity]"]'),init:function(){this.bindEvents()},calculateSum:function(){for(var e=0,t=0;t<this.wines.length;t++)if(this.wines[t].value>0){var n=this.wines[t].id.replace("quantity","price"),i=document.getElementById(n);e+=parseFloat(i.value)*parseInt(this.wines[t].value)}var u=e.toFixed(2)/1.19,a=parseFloat(e.toFixed(2))-parseFloat(u.toFixed(2));document.getElementById("tx_vinou_enquiry[net]").value=u.toFixed(2),document.getElementById("tx_vinou_enquiry[tax]").value=a.toFixed(2),document.getElementById("tx_vinou_enquiry[gross]").value=e.toFixed(2)},bindEvents:function(){for(var e=this,t=0;t<e.wines.length;t++)e.wines[t].addEventListener("input",(function(){e.calculateSum()}))}};vinouEnquiry.init();
var vinouShop={addForms:"form.add-item-form",updateForms:"form.edit-item-form",deleteItemButtons:"a.delete-basket-item",quantityEditInputs:'form.basket-edit-form input[name="quantity"]',token:null,dropper:null,quantity:0,timeout:null,tempquantity:0,currency:" €",basketToCheckout:null,basketMessage:null,nextRangeHint:null,packageRanges:null,init:function(){this.basketToCheckout=document.getElementById("basket-to-checkout"),this.basketMessage=document.getElementById("basket-flash-message"),this.nextRangeHint=document.getElementById("next-range-hint"),this.bindEvents(),this.createDropper(),this.updateBasketCount(),this.buildPackageRanges()},buildPackageRanges:function(){var e=document.querySelectorAll("#package-steps-table .range");if(0==e.length)return!1;this.packageRanges=[];for(var t=0;t<e.length;t++)this.packageRanges.push({from:e[t].getAttribute("data-from"),to:e[t].getAttribute("data-to")})},detectPackageRange:function(e){for(var t={valid:!1,current:null,prevRange:null,nextRange:null},a=0;a<this.packageRanges.length;a++)e>this.packageRanges[a].from&&e>this.packageRanges[a].to&&(t.prevRange=this.packageRanges[a]),e<this.packageRanges[a].from&&e<this.packageRanges[a].to&&(t.nextRange?parseInt(t.nextRange.from)>parseInt(this.packageRanges[a].from)&&(t.nextRange=this.packageRanges[a]):t.nextRange=this.packageRanges[a]),e>=this.packageRanges[a].from&&e<=this.packageRanges[a].to&&(t.valid=!0,t.current=this.packageRanges[a]);return t},createDropper:function(){this.dropper=document.createElement("DIV"),this.dropper.id="basket-dropper",document.body.appendChild(this.dropper)},addItemToBasket:function(e){var t=this,a=document.querySelector(".wine-details"),n=document.getElementById("shop-list-item-"+e.item_id);if(!a&&!n)return!1;var s=a||n,i=s.querySelector(".image img").cloneNode(!0);t.dropper.setAttribute("data-status","visible"),t.dropper.innerHTML="",t.dropper.appendChild(i);var r=s.getBoundingClientRect();t.dropper.style.top=parseInt(r.top)+"px",t.dropper.style.left=parseInt(r.left)+"px";var o=document.querySelector(".basket-status .juwel").getBoundingClientRect();t.dropper.setAttribute("data-status","tobasket"),t.dropper.style.top=parseInt(o.top)+"px",t.dropper.style.left=parseInt(o.left)+"px";setTimeout((function(){t.dropper.setAttribute("data-status","hidden")}),800);var u={data:e};t.basketAction("addItem",u,(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde in den Warenkorb gelegt"),t.updateBasketCount();var a=document.querySelector("#shop-list-item-"+e.item_id+" .basket-overlay");if(a){response=JSON.parse(this.responseText),a.setAttribute("data-status","visible");for(var n=a.querySelectorAll("input"),s=0;s<n.length;s++)response.data[n[s].name]&&(n[s].value=response.data[n[s].name])}}}))},deleteItemFromBasket:function(e,t){var a=this,n={id:e},s=document.getElementById("basket-row-"+e);s&&s.setAttribute("data-status","hidden"),a.basketAction("deleteItem",n,(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde gelöscht"),a.updateBasketCount(),s&&s.parentNode.removeChild(s);var e=document.querySelector("#shop-list-item-"+t+" .basket-overlay");e&&e.setAttribute("data-status","hidden")}}))},updateBasketItem:function(e){var t=this,a={id:e.id,data:{quantity:e.quantity}};if(e.quantity>0){var n=document.getElementById("basket-row-"+e.id);if(n){var s=e.quantity*parseFloat(e.price);n.querySelector(".price strong").innerHTML=s.toFixed(2).replace(".",",")+t.currency}t.basketAction("editItem",a,(function(){200===this.status&&(toast.show("Erfolgreich","Ihre Position wurde geändert"),t.updateBasketCount())}))}else t.basketAction("deleteItem",{id:e.id},(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde gelöscht"),t.updateBasketCount();var a=document.getElementById("basket-row-"+e.id);a&&a.parentNode.removeChild(a)}}))},updateBasketCount:function(){var e=this,t=document.querySelector(".basket-status");t.setAttribute("data-status","normal"),e.basketAction("get",{},(function(){if(200==this.status){response=JSON.parse(this.responseText);var a={quantity:0,net:0,tax:0,gross:0};response.basketItems?(response.basketItems.forEach((function(e){a.quantity+=e.quantity;var t=e.quantity*e.item.gross;e.item.prices&&e.item.prices[0]&&(t=e.item.prices[0].gross);var n=t/(1+e.item.taxrate/100),s=t-(n=Math.round(100*n)/100);a.gross+=t,a.tax+=s,a.net+=n})),e.basketAction("checkquantity",{quantity:a.quantity},(function(){if(!document.getElementById("basket-table")||0==a.quantity)return!0;var t="disabled",n="visible";if(200==this.status){t="ready",n="hidden";var s=document.getElementById("flash-messages");s&&s.parentNode.removeChild(s)}if(e.basketToCheckout&&e.basketToCheckout.setAttribute("data-status",t),e.basketMessage&&e.basketMessage.setAttribute("data-status",n),e.nextRangeHint){var i=e.detectPackageRange(a.quantity);if(i.valid)e.nextRangeHint.innerText="",e.nextRangeHint.setAttribute("data-status","hidden");else{var r=i.nextRange.from-a.quantity,o="Noch "+parseInt(r)+" Flasche";r>1&&(o+="n"),e.nextRangeHint.innerText=o,e.nextRangeHint.setAttribute("data-status","visible")}}})),e.basketAction("findPackage",{type:"bottles",quantity:a.quantity},(function(){response=JSON.parse(this.responseText),packagePrice=document.querySelector("#package-row .package-price"),response&&response.gross?(a.tax+=1*response.tax,a.net+=1*response.net,a.gross+=1*response.gross,packageGross=response.gross.replace(".",",")+e.currency):packageGross="0,00"+e.currency,packagePrice&&(packagePrice.innerHTML=packageGross),document.querySelector(".basket-status .juwel").innerHTML=a.quantity,e.quantity=a.quantity,t.setAttribute("data-status","updated"),e.updateBasketSum(a);var n=document.getElementById("basket-table");n&&0===e.quantity&&n.parentNode.removeChild(n)}))):(document.querySelector(".basket-status .juwel").innerHTML=a.quantity,e.quantity=a.quantity,t.setAttribute("data-status","updated"),e.updateBasketSum(a))}}))},updateBasketSum:function(e){for(var t in e)e.hasOwnProperty(t)&&(el=document.querySelector("#basket-table #basket-sum-"+t),el&&(el.innerHTML=e[t].toFixed(2).replace(".",",")+this.currency));var a=document.getElementById("quantity-warning"),n=document.querySelector(".basket-controls");if(a&&n&&n.hasAttribute("data-minbasketsize")){var s=n.getAttribute("data-minbasketsize"),i=e.quantity<s?"hidden":"visible";a.setAttribute("data-checkout",i),n.setAttribute("data-status",i)}},basketAction:function(e,t,a){var n=Array.prototype.slice.call(arguments,3),s=new XMLHttpRequest;s.onload=function(){if(4===s.readyState)switch(s.status){case 200:a.apply(s,n);break;case 401:localStorage.removeItem("token"),a.apply(s,n);break;default:a.apply(s,n)}},s.callback=a,t.action=e,s.open("POST","/?eID=vinouActions",!0),s.setRequestHeader("Content-type","application/json"),s.send(JSON.stringify(t))},submitAddForm:function(e){var t=this;0===t.quantity?new vDialog({title:"Altersabfrage",description:"Gerne liefern wir Ihnen Ihre Weine. Bitte bestätigen Sie uns, dass Sie dafür die notwendigen Altersbeschränkungen erfüllen.",yes:"Ja, ich bin 18",no:"Abbrechen",ok:function(){t.addItemToBasket(t.serializeForm(e))}}):t.addItemToBasket(t.serializeForm(e))},bindEvents:function(){for(var e=this,t=(document.getElementById("basket-dropper"),document.querySelectorAll(e.addForms)),a=0;a<t.length;a++){t[a].addEventListener?t[a].addEventListener("submit",(function(t){t.preventDefault(),e.submitAddForm(this)}),!0):t[a].attachEvent("onsubmit",(function(t){t.preventDefault(),e.submitAddForm(this)})),t[a].querySelector(".add-basket").addEventListener("click",(function(t){t.preventDefault(),e.submitAddForm(this.form)}))}var n=document.querySelectorAll("button.inc");for(a=0;a<n.length;a++)n[a].addEventListener("click",(function(t){t.preventDefault();var a=this.parentNode.querySelector('input[name="quantity"]'),n=a.value;e.tempquantity=n;var s=a.getAttribute("max")?a.getAttribute("max"):99;return a.value=n<s?parseInt(n)+1:s,e.setUpdateTimeout(a),!1}));var s=document.querySelectorAll("button.dec");for(a=0;a<s.length;a++)s[a].addEventListener("click",(function(t){t.preventDefault();var a=this.parentNode.querySelector('input[name="quantity"]'),n=a.value;e.tempquantity=n;var s=a.getAttribute("min")?a.getAttribute("min"):1;return a.value=n>s?parseInt(n)-1:s,e.setUpdateTimeout(a),!1}));var i=document.querySelectorAll(e.updateForms);for(a=0;a<i.length;a++){i[a].addEventListener?i[a].addEventListener("submit",(function(t){t.preventDefault(),e.updateBasketItem(e.serializeForm(this))}),!0):i[a].attachEvent("onsubmit",(function(t){t.preventDefault(),e.updateBasketItem(e.serializeForm(this))}));var r=i[a].querySelector('input[name="quantity"]');r.addEventListener("focus",(function(t){e.tempquantity=this.value})),r.addEventListener("blur",(function(t){e.setUpdateTimeout(this)})),r.addEventListener("input",(function(t){e.setUpdateTimeout(this)}))}var o=document.querySelectorAll(e.deleteItemButtons);for(a=0;a<o.length;a++)o[a].addEventListener("click",(function(t){t.preventDefault();var a=this.getAttribute("data-id"),n=this.getAttribute("data-wine-id");return e.deleteItemFromBasket(a,n),!1}));var u=document.querySelector("#deliveryAdress");u&&u.addEventListener("change",(function(){document.querySelector("#delivery-fieldset").setAttribute("data-visible",this.checked?1:0);var e=document.querySelectorAll('#delivery-fieldset [data-required="1"]');this.checked?e.forEach((function(e){e.setAttribute("required","required")})):e.forEach((function(e){e.removeAttribute("required")}))}))},setUpdateTimeout:function(e){var t=this;t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout((function(){t.tempquantity!=e.value&&e.value>0&&(t.tempquantity=null,t.updateBasketItem(t.serializeForm(e.form)))}),500)},serializeForm:function(e){if(e&&"FORM"===e.nodeName){var t,a,n={};for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"number":case"email":case"date":case"hidden":case"password":case"button":case"reset":case"submit":n[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"checkbox":case"radio":e.elements[t].checked&&(n[e.elements[t].name]=encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":n[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"SELECT":switch(e.elements[t].type){case"select-one":n[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"select-multiple":for(a=e.elements[t].options.length-1;a>=0;a-=1)e.elements[t].options[a].selected&&(n[e.elements[t].name]=encodeURIComponent(e.elements[t].options[a].value))}}return n}},isTouchDevice:function(){var e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(function(e){return window.matchMedia(e).matches})(["(",e.join("touch-enabled),("),"heartz",")"].join(""))}};vinouShop.init();
var vinouList={searchMap:[],list:null,allowedFilter:["place","type","vintage","categories"],arrayProperties:["categories"],clusterSelector:".vinou-cluster-item",containerId:"vinou-list",container:null,options:{valueNames:[{data:["name","vintage","place","type","categories"]}],page:5,pagination:!0},init:function(){this.container=document.getElementById(this.containerId),this.container&&(this.initOptions(),this.initList(),this.loadFilter(),this.bindEvents(),this.initialSearch())},initOptions:function(){$this=this,$this.options.page=document.getElementById($this.containerId).getAttribute("data-items-per-page")},initList:function(){$this=this,$this.list=new List($this.containerId,$this.options),$this.list.sort("sorting",{order:"asc",alphabet:'0123456789AaBbCcDdEÉeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvXxYyZzÅåÄäÖö@"'}),$this.list.update()},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},loadFilter:function(){$this=this;var t=new URL(window.location.href);$this.allowedFilter.forEach((function(e){var i=t.searchParams.get(e);if(i){var s="cluster["+e+"]["+i+"]";document.getElementById(s).checked=!0,$this.searchMap[e]=[],$this.searchMap[e].push(i),document.querySelector("#"+e+"-cluster-group h3").setAttribute("data-status","open"),document.querySelector("#"+e+"-cluster-group ul").style.display="block"}})),$this.filterList()},initialSearch:function(){var t=new URL(window.location.href).searchParams.get("search");t&&(document.getElementById("search-phrase").value=t,this.list.search(t))},filterList:function(){$this=this,$this.list.filter((function(t){for(var e in $this.searchMap)if($this.arrayProperties.indexOf(e)>-1&&t.values()[e]){var i=t.values()[e].split(", "),s=!1;if(i.forEach((function(t){$this.searchMap[e].indexOf(t)>-1&&(s=!0)})),!s)return!1}else if(-1===$this.searchMap[e].indexOf(t.values()[e]))return!1;return!0})),$this.list.update()},bindEvents:function(){for(var t=this,e=document.querySelectorAll(t.clusterSelector),i=0;i<e.length;i++)e[i].addEventListener("change",(function(){var e=this.getAttribute("data-name");if(this.checked)void 0===t.searchMap[e]&&(t.searchMap[e]=[]),t.searchMap[e].push(this.value);else{if(void 0!==t.searchMap[e]){var i=t.searchMap[e].indexOf(this.value);-1!==i&&t.searchMap[e].splice(i,1)}0==t.searchMap[e].length&&delete t.searchMap[e]}t.filterList()}));var s=document.querySelectorAll(".pagination");for(i=0;i<s.length;i++)s[i].addEventListener("click",(function(e){if(e.target&&"page"==e.target.className){var i=document.getElementById(t.containerId);window.scrollTo(i.offsetLeft,i.offsetTop)}}));document.getElementById("search-phrase").addEventListener("keyup",(function(){t.list.search(this.value)}))}};vinouList.init();