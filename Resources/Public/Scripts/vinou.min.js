var vinouEnquiry={wines:document.querySelectorAll('input[name*="[quantity]"]'),init:function(){this.bindEvents()},calculateSum:function(){for(var e=0,t=0;t<this.wines.length;t++)if(this.wines[t].value>0){var n=this.wines[t].id.replace("quantity","price"),i=document.getElementById(n);e+=parseFloat(i.value)*parseInt(this.wines[t].value)}var u=e.toFixed(2)/1.19,a=parseFloat(e.toFixed(2))-parseFloat(u.toFixed(2));document.getElementById("tx_vinou_enquiry[net]").value=u.toFixed(2),document.getElementById("tx_vinou_enquiry[tax]").value=a.toFixed(2),document.getElementById("tx_vinou_enquiry[gross]").value=e.toFixed(2)},bindEvents:function(){for(var e=this,t=0;t<e.wines.length;t++)e.wines[t].addEventListener("input",(function(){e.calculateSum()}))}};vinouEnquiry.init();
var vinouShop={addForms:"form.add-item-form",updateForms:"form.edit-item-form",deleteItemButtons:"a.delete-basket-item",quantityEditInputs:'form.basket-edit-form input[name="quantity"]',token:null,dropper:null,quantity:0,timeout:null,tempquantity:0,currency:" €",basketToCheckout:null,basketMessages:null,init:function(){this.basketToCheckout=document.getElementById("basket-to-checkout"),this.basketMessages=document.getElementById("basket-flash-messages"),this.bindEvents(),this.createDropper(),this.updateBasketCount()},createDropper:function(){this.dropper=document.createElement("DIV"),this.dropper.id="basket-dropper",document.body.appendChild(this.dropper)},addItemToBasket:function(e){var t=this,n=document.querySelector(".wine-details"),a=document.getElementById("shop-list-item-"+e.item_id);if(!n&&!a)return!1;var s=n||a,i=s.querySelector(".image img").cloneNode(!0);t.dropper.setAttribute("data-status","visible"),t.dropper.innerHTML="",t.dropper.appendChild(i);var r=s.getBoundingClientRect();t.dropper.style.top=parseInt(r.top)+"px",t.dropper.style.left=parseInt(r.left)+"px";var o=document.querySelector(".basket-status .juwel").getBoundingClientRect();t.dropper.setAttribute("data-status","tobasket"),t.dropper.style.top=parseInt(o.top)+"px",t.dropper.style.left=parseInt(o.left)+"px";setTimeout((function(){t.dropper.setAttribute("data-status","hidden")}),800);var u={data:e};t.basketAction("addItem",u,(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde in den Warenkorb gelegt"),t.updateBasketCount();var n=document.querySelector("#shop-list-item-"+e.item_id+" .basket-overlay");if(n){response=JSON.parse(this.responseText),n.setAttribute("data-status","visible");for(var a=n.querySelectorAll("input"),s=0;s<a.length;s++)response.data[a[s].name]&&(a[s].value=response.data[a[s].name])}}}))},deleteItemFromBasket:function(e,t){var n=this,a={id:e},s=document.getElementById("basket-row-"+e);s&&s.setAttribute("data-status","hidden"),n.basketAction("deleteItem",a,(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde gelöscht"),n.updateBasketCount(),s&&s.parentNode.removeChild(s);var e=document.querySelector("#shop-list-item-"+t+" .basket-overlay");e&&e.setAttribute("data-status","hidden")}}))},updateBasketItem:function(e){var t=this,n={id:e.id,data:{quantity:e.quantity}};if(e.quantity>0){var a=document.getElementById("basket-row-"+e.id);if(a){var s=e.quantity*parseFloat(e.price);a.querySelector(".price strong").innerHTML=s.toFixed(2).replace(".",",")+t.currency}t.basketAction("editItem",n,(function(){200===this.status&&(toast.show("Erfolgreich","Ihre Position wurde geändert"),t.updateBasketCount())}))}else t.basketAction("deleteItem",{id:e.id},(function(){if(200===this.status){toast.show("Erfolgreich","Ihre Position wurde gelöscht"),t.updateBasketCount();var n=document.getElementById("basket-row-"+e.id);n&&n.parentNode.removeChild(n)}}))},updateBasketCount:function(){var e=this,t=document.querySelector(".basket-status");t.setAttribute("data-status","normal"),e.basketAction("get",{},(function(){if(200==this.status){response=JSON.parse(this.responseText);var n={quantity:0,net:0,tax:0,gross:0};response.basketItems?(response.basketItems.forEach((function(e){n.quantity+=e.quantity,e.item.prices&&e.item.prices[0]?(n.tax+=e.quantity*e.item.prices[0].tax,n.net+=e.quantity*e.item.prices[0].net,n.gross+=e.quantity*e.item.prices[0].gross):(n.tax+=e.quantity*e.item.tax,n.net+=e.quantity*e.item.net,n.gross+=e.quantity*e.item.gross)})),e.basketAction("checkquantity",{quantity:n.quantity},(function(){e.basketMessages&&e.basketMessages.setAttribute("data-status","hidden"),200==this.status?e.basketToCheckout&&e.basketToCheckout.setAttribute("data-status","visible"):(e.basketToCheckout&&e.basketToCheckout.setAttribute("data-status","hidden"),response=JSON.parse(this.responseText),toast.screentime=4e3,response[0].minBasketSize&&toast.show("Mindestbestellmenge nicht erreicht","Sie haben nicht die notwendige Mindestbestellmenge von <strong>"+response[0].minBasketSize+" Flaschen<strong> erreicht."),response[0].packageSteps&&toast.show("Versandgröße nicht passend","Sie haben nicht die passende Versandgröße von <strong>"+response[0].packageSteps+" Flaschen<strong> erreicht."),toast.screentime=2e3)})),e.basketAction("findPackage",{type:"bottles",quantity:n.quantity},(function(){response=JSON.parse(this.responseText),packagePrice=document.querySelector("#package-row .package-price"),response&&response.gross?(n.tax+=1*response.tax,n.net+=1*response.net,n.gross+=1*response.gross,packageGross=response.gross.replace(".",",")+e.currency):packageGross="0,00"+e.currency,packagePrice&&(packagePrice.innerHTML=packageGross),document.querySelector(".basket-status .juwel").innerHTML=n.quantity,e.quantity=n.quantity,t.setAttribute("data-status","updated"),e.updateBasketSum(n);var a=document.getElementById("basket-table");a&&0===e.quantity&&a.parentNode.removeChild(a)}))):(document.querySelector(".basket-status .juwel").innerHTML=n.quantity,e.quantity=n.quantity,t.setAttribute("data-status","updated"),e.updateBasketSum(n))}}))},updateBasketSum:function(e){for(var t in e)e.hasOwnProperty(t)&&(el=document.querySelector("#basket-table #basket-sum-"+t),el&&(el.innerHTML=e[t].toFixed(2).replace(".",",")+this.currency));var n=document.getElementById("quantity-warning"),a=document.querySelector(".basket-controls");if(n&&a&&a.hasAttribute("data-minbasketsize")){var s=a.getAttribute("data-minbasketsize"),i=e.quantity<s?"hidden":"visible";n.setAttribute("data-checkout",i),a.setAttribute("data-status",i)}},basketAction:function(e,t,n){var a=Array.prototype.slice.call(arguments,3),s=new XMLHttpRequest;s.onload=function(){if(4===s.readyState)switch(s.status){case 200:n.apply(s,a);break;case 401:localStorage.removeItem("token"),n.apply(s,a);break;default:n.apply(s,a)}},s.callback=n,t.action=e,s.open("POST","/?eID=vinouActions",!0),s.setRequestHeader("Content-type","application/json"),s.send(JSON.stringify(t))},submitAddForm:function(e){var t=this;0===t.quantity?new vDialog({title:"Altersabfrage",description:"Gerne liefern wir Ihnen Ihre Weine. Bitte bestätigen Sie uns, dass Sie dafür die notwendigen Altersbeschränkungen erfüllen.",yes:"Ja, ich bin 18",no:"Abbrechen",ok:function(){t.addItemToBasket(t.serializeForm(e))}}):t.addItemToBasket(t.serializeForm(e))},bindEvents:function(){for(var e=this,t=(document.getElementById("basket-dropper"),document.querySelectorAll(e.addForms)),n=0;n<t.length;n++){t[n].addEventListener?t[n].addEventListener("submit",(function(t){t.preventDefault(),e.submitAddForm(this)}),!0):t[n].attachEvent("onsubmit",(function(t){t.preventDefault(),e.submitAddForm(this)})),t[n].querySelector(".add-basket").addEventListener("click",(function(t){t.preventDefault(),e.submitAddForm(this.form)}))}var a=document.querySelectorAll("button.inc");for(n=0;n<a.length;n++)a[n].addEventListener("click",(function(t){t.preventDefault();var n=this.parentNode.querySelector('input[name="quantity"]'),a=n.value;e.tempquantity=a;var s=n.getAttribute("max")?n.getAttribute("max"):99;return n.value=a<s?parseInt(a)+1:s,e.setUpdateTimeout(n),!1}));var s=document.querySelectorAll("button.dec");for(n=0;n<s.length;n++)s[n].addEventListener("click",(function(t){t.preventDefault();var n=this.parentNode.querySelector('input[name="quantity"]'),a=n.value;e.tempquantity=a;var s=n.getAttribute("min")?n.getAttribute("min"):1;return n.value=a>s?parseInt(a)-1:s,e.setUpdateTimeout(n),!1}));var i=document.querySelectorAll(e.updateForms);for(n=0;n<i.length;n++){i[n].addEventListener?i[n].addEventListener("submit",(function(t){t.preventDefault(),e.updateBasketItem(e.serializeForm(this))}),!0):i[n].attachEvent("onsubmit",(function(t){t.preventDefault(),e.updateBasketItem(e.serializeForm(this))}));var r=i[n].querySelector('input[name="quantity"]');r.addEventListener("focus",(function(t){e.tempquantity=this.value})),r.addEventListener("blur",(function(t){e.setUpdateTimeout(this)})),r.addEventListener("input",(function(t){e.setUpdateTimeout(this)}))}var o=document.querySelectorAll(e.deleteItemButtons);for(n=0;n<o.length;n++)o[n].addEventListener("click",(function(t){t.preventDefault();var n=this.getAttribute("data-id"),a=this.getAttribute("data-wine-id");return e.deleteItemFromBasket(n,a),!1}));var u=document.querySelector("#deliveryAdress");u&&u.addEventListener("change",(function(){document.querySelector("#delivery-fieldset").setAttribute("data-visible",this.checked?1:0);var e=document.querySelectorAll('#delivery-fieldset [data-required="1"]');this.checked?e.forEach((function(e){e.setAttribute("required","required")})):e.forEach((function(e){e.removeAttribute("required")}))}))},setUpdateTimeout:function(e){var t=this;t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout((function(){t.tempquantity!=e.value&&e.value>0&&(t.tempquantity=null,t.updateBasketItem(t.serializeForm(e.form)))}),500)},serializeForm:function(e){if(e&&"FORM"===e.nodeName){var t,n,a={};for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"number":case"email":case"date":case"hidden":case"password":case"button":case"reset":case"submit":a[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"checkbox":case"radio":e.elements[t].checked&&(a[e.elements[t].name]=encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":a[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"SELECT":switch(e.elements[t].type){case"select-one":a[e.elements[t].name]=encodeURIComponent(e.elements[t].value);break;case"select-multiple":for(n=e.elements[t].options.length-1;n>=0;n-=1)e.elements[t].options[n].selected&&(a[e.elements[t].name]=encodeURIComponent(e.elements[t].options[n].value))}}return a}},isTouchDevice:function(){var e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(function(e){return window.matchMedia(e).matches})(["(",e.join("touch-enabled),("),"heartz",")"].join(""))}};vinouShop.init();
var vinouList={searchMap:[],list:null,allowedFilter:["place","type","vintage","categories"],arrayProperties:["categories"],clusterSelector:".vinou-cluster-item",containerId:"vinou-list",container:null,options:{valueNames:[{data:["name","vintage","place","type","categories"]}],page:5,pagination:!0},init:function(){this.container=document.getElementById(this.containerId),this.container&&(this.initOptions(),this.initList(),this.loadFilter(),this.bindEvents(),this.initialSearch())},initOptions:function(){$this=this,$this.options.page=document.getElementById($this.containerId).getAttribute("data-items-per-page")},initList:function(){$this=this,$this.list=new List($this.containerId,$this.options),$this.list.sort("sorting",{order:"asc",alphabet:'0123456789AaBbCcDdEÉeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvXxYyZzÅåÄäÖö@"'}),$this.list.update()},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},loadFilter:function(){$this=this;var t=new URL(window.location.href);$this.allowedFilter.forEach((function(e){var i=t.searchParams.get(e);if(i){var s="cluster["+e+"]["+i+"]";document.getElementById(s).checked=!0,$this.searchMap[e]=[],$this.searchMap[e].push(i),document.querySelector("#"+e+"-cluster-group h3").setAttribute("data-status","open"),document.querySelector("#"+e+"-cluster-group ul").style.display="block"}})),$this.filterList()},initialSearch:function(){var t=new URL(window.location.href).searchParams.get("search");t&&(document.getElementById("search-phrase").value=t,this.list.search(t))},filterList:function(){$this=this,$this.list.filter((function(t){for(var e in $this.searchMap)if($this.arrayProperties.indexOf(e)>-1&&t.values()[e]){var i=t.values()[e].split(", "),s=!1;if(i.forEach((function(t){$this.searchMap[e].indexOf(t)>-1&&(s=!0)})),!s)return!1}else if(-1===$this.searchMap[e].indexOf(t.values()[e]))return!1;return!0})),$this.list.update()},bindEvents:function(){for(var t=this,e=document.querySelectorAll(t.clusterSelector),i=0;i<e.length;i++)e[i].addEventListener("change",(function(){var e=this.getAttribute("data-name");if(this.checked)void 0===t.searchMap[e]&&(t.searchMap[e]=[]),t.searchMap[e].push(this.value);else{if(void 0!==t.searchMap[e]){var i=t.searchMap[e].indexOf(this.value);-1!==i&&t.searchMap[e].splice(i,1)}0==t.searchMap[e].length&&delete t.searchMap[e]}t.filterList()}));var s=document.querySelectorAll(".pagination");for(i=0;i<s.length;i++)s[i].addEventListener("click",(function(e){if(e.target&&"page"==e.target.className){var i=document.getElementById(t.containerId);window.scrollTo(i.offsetLeft,i.offsetTop)}}));document.getElementById("search-phrase").addEventListener("keyup",(function(){t.list.search(this.value)}))}};vinouList.init();